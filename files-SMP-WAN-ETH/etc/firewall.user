# This file is interpreted as shell script.
# Put your custom iptables rules here, they will
# be executed with each firewall (re-)start.

# Internal uci firewall chains are flushed and recreated on reload, so
# put custom rules into the root chains e.g. INPUT or FORWARD or into the
# special user chains, e.g. input_wan_rule or postrouting_lan_rule.

iptables -t raw -A OUTPUT -p tcp -m tcp --dport 554 -j CT --helper rtsp
iptables -t nat -A PREROUTING -p udp --dport 123 -j REDIRECT --to-ports 123

for i in /proc/sys/net/ipv4/conf/*/bootp_relay; do echo 0 > $i; done

IPT=iptables
NET_LAN=192.168.1.1/24
IF_LAN=br-lan

$IPT -t raw -A PREROUTING -i $IF_LAN -s $NET_LAN -p tcp --dport 32777:32780 -j CT --notrack #---------- don't track nfs
$IPT -t raw -A PREROUTING -i $IF_LAN -s $NET_LAN -p udp --dport 32777:32780 -j CT --notrack #---------- don't track nfs
$IPT -t raw -A OUTPUT -o $IF_LAN -d $NET_LAN -p tcp --sport 32777:32780 -j CT --notrack #---------- don't track nfs
$IPT -t raw -A OUTPUT -o $IF_LAN -d $NET_LAN -p udp --sport 32777:32780 -j CT --notrack #---------- don't track nfs

. /lib/functions/network.sh
network_get_physdev ifname wan

